#!/usr/bin/env python3
"""
ストーリーマスターを生成するスクリプト
72ダンジョンに対応する72ストーリーを生成
解放フロー: ストーリーN読む → ダンジョンN解放 → クリア → ストーリーN+1解放
"""

import json
from pathlib import Path

# 章別テーマとストーリー概要
CHAPTER_STORIES = {
    1: {
        "theme": "森・洞窟",
        "arc_title": "冒険の始まり",
        "stories": [
            ("旅立ちの朝", "故郷を後にし、冒険者としての第一歩を踏み出す。"),
            ("森の入り口", "深い森の入り口に到着。不気味な気配が漂う。"),
            ("迷いの森", "森の奥へ進むほど、道が複雑になっていく。"),
            ("獣の縄張り", "野生の獣たちの縄張りに足を踏み入れた。"),
            ("隠された洞窟", "森の奥で古い洞窟の入り口を発見する。"),
            ("洞窟の探索", "洞窟内部は予想以上に広く、深かった。"),
            ("地底の住人", "洞窟の奥には不思議な生物たちが住んでいた。"),
            ("森の主", "森を支配する強大な存在との対峙。"),
        ],
    },
    2: {
        "theme": "山・峠",
        "arc_title": "山岳への道",
        "stories": [
            ("山麓の村", "山の麓にある小さな村に立ち寄る。"),
            ("険しい山道", "本格的な山登りが始まった。"),
            ("山賊の襲撃", "山道で山賊の一団に遭遇する。"),
            ("崖の道", "断崖絶壁に沿った危険な道を進む。"),
            ("山の祠", "古い祠を発見。何かが祀られている。"),
            ("嵐の夜", "山小屋で激しい嵐を耐え凌ぐ。"),
            ("峠の番人", "峠を守る番人が行く手を阻む。"),
            ("山頂の魔獣", "山頂に棲む伝説の魔獣との決戦。"),
        ],
    },
    3: {
        "theme": "遺跡・廃墟",
        "arc_title": "古代の秘密",
        "stories": [
            ("廃墟の街", "かつて栄えた街の廃墟を発見する。"),
            ("石碑の謎", "古代文字が刻まれた石碑を調べる。"),
            ("地下への階段", "廃墟の下に広がる地下空間への入り口。"),
            ("亡霊の嘆き", "この地に縛られた亡霊たちの声が聞こえる。"),
            ("封印の間", "何かを封じ込めていた部屋を発見。"),
            ("古代の番人", "遺跡を守り続ける古代の存在。"),
            ("禁断の書庫", "失われた知識が眠る書庫。"),
            ("遺跡の主", "遺跡の最深部で待ち受ける存在。"),
        ],
    },
    4: {
        "theme": "沼・毒地",
        "arc_title": "瘴気の地",
        "stories": [
            ("毒沼の入り口", "瘴気漂う沼地に足を踏み入れる。"),
            ("腐食の森", "毒に侵された森を進む。"),
            ("沼の村", "沼地に適応した奇妙な村人たち。"),
            ("毒の精", "沼から生まれた毒の精霊との遭遇。"),
            ("沈んだ神殿", "沼に沈んだ古い神殿を発見。"),
            ("瘴気の源", "毒の源となっている場所を突き止める。"),
            ("沼の魔女", "沼地を支配する魔女との対峙。"),
            ("浄化の儀式", "沼地を浄化するための最終決戦。"),
        ],
    },
    5: {
        "theme": "火山・灼熱",
        "arc_title": "炎の試練",
        "stories": [
            ("灼熱の大地", "赤く燃える大地に到着。"),
            ("溶岩の川", "流れる溶岩を越えて進む。"),
            ("炎の洞窟", "火山内部の洞窟を探索。"),
            ("火の精霊", "炎を操る精霊たちとの遭遇。"),
            ("鍛冶の神殿", "古代の鍛冶神を祀る神殿。"),
            ("火竜の巣", "火竜の住処に近づく。"),
            ("試練の炎", "炎による試練を乗り越える。"),
            ("炎の王", "火山の主である炎の王との決戦。"),
        ],
    },
    6: {
        "theme": "氷原・凍土",
        "arc_title": "凍てつく世界",
        "stories": [
            ("氷の境界", "永久凍土の地に足を踏み入れる。"),
            ("吹雪の中", "激しい吹雪の中を進む。"),
            ("氷の洞窟", "美しくも危険な氷の洞窟。"),
            ("凍りついた村", "かつての村が氷に閉ざされていた。"),
            ("氷の精霊", "冷気を操る精霊との遭遇。"),
            ("氷竜の領域", "氷竜が支配する領域に踏み込む。"),
            ("凍てつく神殿", "氷に覆われた古代の神殿。"),
            ("氷の女王", "凍土を支配する女王との最終決戦。"),
        ],
    },
    7: {
        "theme": "魔界・深淵",
        "arc_title": "闇の領域",
        "stories": [
            ("魔界への門", "異界への門が開かれた。"),
            ("悪魔の領土", "悪魔たちが支配する地に踏み込む。"),
            ("堕落の城", "かつての聖なる城が闇に染まっていた。"),
            ("深淵の声", "深淵から響く誘惑の声。"),
            ("魔将との対峙", "魔界の将との戦い。"),
            ("失われた魂", "囚われた魂たちを解放する。"),
            ("魔王の間", "魔王の居城へと迫る。"),
            ("魔王との決戦", "魔界の支配者との最終決戦。"),
        ],
    },
    8: {
        "theme": "天空・神域",
        "arc_title": "神々の領域",
        "stories": [
            ("天への階段", "天空へと続く階段を発見。"),
            ("雲上の世界", "雲の上に広がる不思議な世界。"),
            ("天使の試練", "天使たちによる試練が始まる。"),
            ("神々の庭園", "神々が創った美しい庭園。"),
            ("聖なる神殿", "最も神聖な神殿に到達。"),
            ("神竜の目覚め", "伝説の神竜が目を覚ます。"),
            ("神の審判", "神による審判の時。"),
            ("神竜との対峙", "世界の守護者との最終決戦。"),
        ],
    },
    9: {
        "theme": "超越領域",
        "arc_title": "世界の果て",
        "stories": [
            ("次元の狭間", "世界の狭間に足を踏み入れる。"),
            ("混沌の海", "秩序なき混沌の海を渡る。"),
            ("始原の地", "全ての始まりの場所。"),
            ("終焉の予兆", "世界の終わりが近づいている。"),
            ("超越者の試練", "超越した存在による試練。"),
            ("虚無との対話", "虚無そのものと対話する。"),
            ("最後の戦い", "全ての決着をつける時。"),
            ("新たなる始まり", "全てを終え、新たな旅立ちへ。"),
        ],
    },
}


def generate_stories():
    """ストーリーデータを生成

    ID対応: ストーリーN → ダンジョンN（1:1対応）
    フロー: ストーリーN読了 → ダンジョンN解放 → クリア → ストーリーN+1解放
    """
    stories = []
    story_id = 1

    for chapter in range(1, 10):  # 9章
        chapter_data = CHAPTER_STORIES[chapter]

        for stage_idx, (title, content) in enumerate(chapter_data["stories"], 1):
            # ストーリーNはダンジョンNを解放（1:1対応）
            dungeon_id = story_id

            # 解放条件: 最初のストーリー以外は前のダンジョンクリアが必要
            if story_id == 1:
                unlock_requirements = []
            else:
                unlock_requirements = [f"dungeonClear:{story_id - 1}"]

            # 報酬（章が進むほど増加）
            base_gold = 100 * chapter
            base_exp = 50 * chapter
            rewards = [
                f"gold_{base_gold + stage_idx * 50}",
                f"exp_{base_exp + stage_idx * 25}",
            ]

            # このストーリーが解放するもの（対応するダンジョン）
            unlocks_modules = [f"dungeon:{dungeon_id}"]

            story = {
                "id": story_id,
                "title": f"{chapter_data['arc_title']} - {title}",
                "content": f"【第{chapter}章 {chapter_data['theme']}】\n\n{content}\n\n（このストーリーを読むとダンジョン「{chapter_data['theme']}・{stage_idx}」が解放されます）",
                "chapter": chapter,
                "section": stage_idx,
                "unlockRequirements": unlock_requirements,
                "rewards": rewards,
                "unlocksModules": unlocks_modules,
            }
            stories.append(story)
            story_id += 1

    return stories


def main():
    stories = generate_stories()

    output = {
        "version": "1.0.0",
        "storyNodes": stories,
    }

    output_path = Path(__file__).parent.parent / "MasterData" / "StoryMaster.json"
    with open(output_path, "w", encoding="utf-8") as f:
        json.dump(output, f, ensure_ascii=False, indent=2)

    print(f"Generated {len(stories)} stories to {output_path}")


if __name__ == "__main__":
    main()
