# ゲーム全体フロー（実装準拠 1枚）

## 目的
- Epikaの「全体の流れ」を1枚で俯瞰できる仕様としてまとめる
- 迷いが出るポイント（進行・報酬・解放・消費）だけを明記する
- 戦闘式などの詳細は `docs/specs/Battle/*` に委譲する

## 全体像（Core Loop）
1. **ギルド**でキャラクター作成・管理
2. **パーティ編成**（最大6人）
3. **冒険**でダンジョン探索を開始（自動進行）
4. **報酬**（経験値/ゴールド/ドロップ）で育成・装備強化
5. **ストーリー/解放**で次のダンジョンへ

## 主要タブ
- 物語: ストーリー一覧・読了
- ギルド: キャラ作成/蘇生/転職/編成補助
- 冒険: ダンジョン探索の開始/停止/ログ
- 商店: 装備/売買/加工/在庫整理/自動売却
- その他: 図鑑/不具合報告/ベータ機能

## 進行と解放
- ストーリー読了 → 対応するダンジョンを解放
- ダンジョンクリア → 次のストーリーを解放
- 初期解放: unlock条件が空のストーリー/ダンジョンは起動時に解放
- 難易度は称号IDで段階解放
  - 2: 無称号 → 4: 魔性の → 5: 宿った → 6: 伝説の

## 探索フロー
- 出撃時に**生存キャラHPを全回復**
- 探索はフロア×イベント数で自動進行
- イベントカテゴリ: 何も起きない / スクリプト / 戦闘
- フロア最終イベントはボス（ボス定義がある場合）
- RNG状態とドロップ済みIDを保持し、アプリ再起動後も探索再開できる

## 戦闘の終端
- 戦闘の最大ターン数: **20ターン**
- 20ターン到達で**撤退（タイムオーバー）**扱い
- 撤退した戦闘の報酬は得られない
- それまでに得た探索報酬は**ドロップを含めて保持**される

## 報酬・経済
- 経験値: イベント結果に応じて分配
- ゴールド: 探索終了時に加算（戦闘/スクリプトの合算）
- ドロップ: 戦闘勝利時のみ
- 自動売却: 対象アイテムは探索中に即ゴールド化
- 上限:
  - ゴールド 99,999,999
  - キャット・チケット 999

## キャラクター
- 作成: 種族/職業選択 → Lv1/Exp0/HP最大
- 蘇生: HP0のキャラを最大HPの半分（最低1）で復帰
- 転職: 1回のみ、探索中不可、転職時はLv1/Exp0＋装備解除
- マスター職: 元職一致＋Lv50以上で転職可

## パーティ
- 最大6人
- 初期スロット1 → ゴールドで最大7まで拡張
- 探索中パーティのメンバーは装備変更/解雇不可

## アイテム・商店
- 売買・装備・合成・宝石改造・パンドラボックス
- 在庫整理: 99個超の在庫を5個まで減らしチケット獲得
- 準備中: 日替わり/掘り出し物/称号継承/神器交換

## キャット・チケット（使用仕様）
- **出撃時に消費**
  - 1枚/パーティ
  - 一斉出撃はパーティ数分消費
- UIフローは未定（案: 出撃ボタン長押しでON/OFF）
- 効果:
  - 探索時間 × 0.5
  - 冒険タブのパーティ枠上部に表示される**報酬倍率が×2**
- 影響範囲（倍率の対象）:
  - 経験値
  - ゴールド
  - ドロップ率
  - レア率
  - 称号付与率
- 対象範囲（ゴールド）:
  - 戦闘報酬とスクリプト報酬のみ

## ストーリー報酬
- 付与仕様は**未定**（空欄扱い）

## 保存とログ
- 探索ログ/戦闘ログは永続化され、探索履歴から参照可能
- RNG状態を含めて再開可能な探索スナップショットを保持
